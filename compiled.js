(function(){var Aa=Math.imul||function(a,b){return (a*(b>>>16)<<16)+a*(b&65535)|0};var o;function Ca(){window.onload=function(){var a=document.getElementById('game-of-life-canvas'),b=new Ba(a);E(b),Z(b),isTouchDevice()&&(document.getElementById('instructions').innerHTML='Pinch and drag to move around.')}}function F(a,b,c){var e=L(a,b);return fa(c,e)}function D(b){var a=document.getElementById('canvas-container');b.a.width=a.offsetWidth,b.a.height=a.offsetHeight,ma(b.h.b,new Ja(b.a.width,b.a.height),1)}function q(a){return new Ja(a.a.width,a.a.height)}function E(a){a.c.defaultFramebuffer.bind(),a.b.f.bind(0),a.c.gl.viewport(0,0,a.a.width,a.a.height),a.e.use().attrib('quad',a.f,2).uniformi('cellGridTexture',0).uniform('viewportOffset',M(a.h.a)).uniform('viewportSize',M(a.h.b)).uniform('canvasSize',new Float32Array([a.a.width,a.a.height])).uniform('gridSize',new Float32Array([a.b.b,a.b.b])).uniform('showDebugUI',!1,!0).draw(5,4)}function Z(a){setInterval(function(){ha(a.b),E(a)},60)}function _(k){i(k.a,'mousedown',
function(a){for(var s=0,O=k.g,na=O.length;s<na;s=s+1|0){var b=O[s];b.A(a.offsetX,a.offsetY)}}),i(k.a,'mousemove',function(c){for(var t=0,P=k.g,oa=P.length;t<oa;t=t+1|0){var e=P[t];e.B(c.offsetX,c.offsetY)}}),i(k.a,'mouseup',function(f){for(var u=0,Q=k.g,pa=Q.length;u<pa;u=u+1|0){var g=Q[u];g.n(f.offsetX,f.offsetY)}}),i(k.a,'mouseleave',function(j){for(var v=0,R=k.g,qa=R.length;v<qa;v=v+1|0){var h=R[v];h.n(j.offsetX,j.offsetY)}}),i(k.a,'wheel',function(N){for(var w=0,S=k.g,ra=S.length;w<ra;w=w+1|0){var $=S[w];$.C(N.offsetX,N.offsetY,N.deltaY)}}),i(k.a,'touchstart',function(wa){for(var x=0,T=k.j,sa=T.length;x<sa;x=x+1|0){var aa=T[x];aa.W(wa)}}),i(k.a,'touchmove',function(xa){for(var y=0,U=k.j,ta=U.length;y<ta;y=y+1|0){var ba=U[y];ba.X(xa)}}),i(k.a,'touchend',function(ya){for(var z=0,V=k.j,ua=V.length;z<ua;z=z+1|0){var ca=V[z];ca.Y(ya)}})}function da(a){a.b=a.c=null}function r(c,a,b){if(!c.c)throw new Error("Shouldn't call _gridSpaceFromCanvasSpace unless _onDownViewport is set");return F(new Ja(a,b),new Ja(c.a.a.width,
c.a.a.height),c.c.a)}function G(c,a){if(!c.b)throw new Error("Shouldn't call _delta unless _onDownGridSpace is set");var b=J(c.b.a,a);return b.b*=-1,b}function ea(a){return new Fa(a.a.a,a.a.b,a.b.a,a.b.b)}function fa(b,a){return l(b.a,K(a,b.b))}function ga(f,a){for(var b=new Uint8Array(f.b*f.b<<2),c=0,g=a.length;c<g;c=c+1|0){var e=c<<2;b[e]=a[c]^1?0:255,b[e+1|0]=a[c]^1?0:255,b[e+2|0]=a[c]^1?0:255,b[e+3|0]=255}f.f.subset(b,0,0,f.b,f.b)}function ha(b){b.j.attach(b.g),b.f.bind(0),b.a.gl.viewport(0,0,b.b,b.b),b.c.use().attrib('quad',b.e,2).uniformi('cellGridTexture',0).uniform('cellGridSize',new Float32Array([b.b,b.b])).draw(5,4);var a=b.f;b.f=b.g,b.g=a}function H(g,a){var b=d(a.touches)[0],c=d(a.touches)[1],e=new Ja(b.clientX,b.clientY),f=new Ja(c.clientX,c.clientY);return Math.sqrt(la(e,f))}function ia(g,a){var b=d(a.touches)[0],c=d(a.touches)[1],e=new Ja(b.clientX,b.clientY),f=new Ja(c.clientX,c.clientY);return ja(l(e,f),2)}function I(f,a){var b=ia(f,a),c=H(f,a),e=f.c-c;f.e.C(b.a|0,b.b|0,e),f.c=c}function l(b,a){
return new Ja(b.a+a.a,b.b+a.b)}function J(b,a){return new Ja(b.a-a.a,b.b-a.b)}function K(b,a){return new Ja(b.a*a.a,b.b*a.b)}function L(b,a){return new Ja(b.a/a.a,b.b/a.b)}function ja(b,a){return new Ja(b.a/a,b.b/a)}function ka(a){return Math.sqrt(a.a*a.a+a.b*a.b)}function la(b,a){return b.a*a.a+b.b*a.b}function M(a){return new Float32Array([a.a,a.b])}function ma(c,a,b){b?c.b=c.a*a.b/a.a:c.a=c.b*a.a/a.b}function m(){return new Ja(0,0)}function d(a){for(var b=[],c=0,e=a.length;c<e;c=c+1|0)b.push(a[c]);return b}function i(a,b,c){a.addEventListener(b,c)}function p(a){a.preventDefault()}function za(a){this.a=a}function Ba(a){var b=this;if(b.b=b.c=null,b.e=b.f=null,b.g=b.j=null,b.h=null,b.a=a,b.h=new Fa(0,0,700,700),b.c=new Igloo(a),!b.c.gl){document.getElementById('app-container').style.display='none',document.getElementById('webgl-error').style.display=null;throw new Error('Failed to initialize Igloo')}b.b=new Ga(b.c,va),b.c.gl.disable(2929),b.e=b.c.program('glsl/quad.vert','glsl/draw_grid.frag'),b.f=b.c.array(Igloo.QUAD2),
b.g=[new Da(b),new Ea(b)],b.j=[new Ha(b),new Ia(b)],_(b),D(b),i(window,'resize',function(){D(b)})}function Da(a){this.a=a,this.b=this.c=null}o=Da.prototype;o.A=function(a,b){this.c=new za(ea(this.a.h)),this.b=new za(r(this,a,b))};o.B=function(a,b){if(this.b){var c=r(this,a,b),e=G(this,c);this.a.h.a=l(this.c.a.a,e)}};o.n=function(a,b){if(this.b){var c=r(this,a,b),e=G(this,c);ka(e)>10&&(this.a.h.a=l(this.c.a.a,e))}da(this)};o.C=function(a,b,c){};function Ea(a){this.a=a}o=Ea.prototype;o.A=function(a,b){};o.B=function(a,b){};o.n=function(a,b){};o.C=function(a,b,c){b=(q(this.a).b|0)-b|0;var e=F(new Ja(a,b),q(this.a),this.a.h),f=this.a.h.b.b/this.a.h.b.a,g=new Ja(c,c*f),j=l(this.a.h.b,g),h=J(e,K(L(new Ja(a,b),q(this.a)),j));j.a>15&&j.b>15&&j.a<2500&&j.b<2500&&(this.a.h.a=h,this.a.h.b=j)};function Fa(a,b,c,e){this.a=m(),this.b=m(),this.a=new Ja(a,b),this.b=new Ja(c,e)}function Ga(a,b){this.c=this.e=null,this.f=this.g=null,this.j=null,this.a=a,this.b=b;var c=this.a.gl;c.disable(2929),this.c=this.a.program('glsl/quad.vert',
'glsl/game_of_life.frag'),this.e=a.array(Igloo.QUAD2),this.f=this.a.texture(null,6408,10497,9728).blank(this.b,this.b),this.g=this.a.texture(null,6408,10497,9728).blank(this.b,this.b),this.j=this.a.framebuffer();for(var e=new Uint8Array(Aa(this.b,this.b)),f=0,g=e.length;f<g;f=f+1|0)e[f]=Math.random()<.5?1:0;ga(this,e)}function Ha(a){this.a=a,this.b=!1,this.c=null}o=Ha.prototype;o.W=function(a){d(a.touches).length^1||(this.b=!0,this.c=new Da(this.a),this.c.A(d(a.touches)[0].clientX,d(a.touches)[0].clientY)),p(a)};o.X=function(a){this.b&&d(a.touches).length==1&&this.c.B(d(a.touches)[0].clientX,d(a.touches)[0].clientY),p(a)};o.Y=function(a){this.b&&d(a.touches).length==1&&this.c.n(d(a.touches)[0].clientX,d(a.touches)[0].clientY),p(a)};function Ia(a){this.a=a,this.b=!1,this.c=-1,this.e=null}o=Ia.prototype;o.W=function(a){d(a.touches).length^2||(this.b=!0,this.c=H(this,a),this.e=new Ea(this.a))};o.X=function(a){this.b&&d(a.touches).length==2&&I(this,a)};o.Y=function(a){this.b&&d(a.touches).length==2&&(I(this,a),this.b=!1)};
function Ja(a,b){this.a=a,this.b=b}var va=1024;Ca()})();

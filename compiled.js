(function(){var Aa=Math.imul||function(a,b){return (a*(b>>>16)<<16)+a*(b&65535)|0};var o;function Ca(){window.onload=function(){var a=document.getElementById('game-of-life-canvas'),b=new Ba(a);E(b),_(b),isTouchDevice()&&(document.getElementById('instructions').innerHTML='Pinch and drag to move around.')}}function F(a,b,c){var e=L(a,b);return ga(c,e)}function D(b){var a=document.getElementById('canvas-container');b.a.width=a.offsetWidth,b.a.height=a.offsetHeight,N(b.i.b,new Ja(b.a.width,b.a.height),1)}function q(a){return new Ja(a.a.width,a.a.height)}function E(a){a.c.defaultFramebuffer.bind(),a.b.f.bind(0),a.c.gl.viewport(0,0,a.a.width,a.a.height),a.e.use().attrib('quad',a.f,2).uniformi('cellGridTexture',0).uniform('viewportOffset',M(a.i.a)).uniform('viewportSize',M(a.i.b)).uniform('canvasSize',new Float32Array([a.a.width,a.a.height])).uniform('gridSize',new Float32Array([a.b.b,a.b.b])).draw(5,4)}function _(a){setInterval(function(){ia(a.b),E(a)},60)}function $(j){h(j.a,'mousedown',function(a){for(var s=0,P=j.g,na=P.length;s<na;s=s+1|0){
var b=P[s];b.A(a.offsetX,a.offsetY)}}),h(j.a,'mousemove',function(c){for(var t=0,Q=j.g,oa=Q.length;t<oa;t=t+1|0){var e=Q[t];e.B(c.offsetX,c.offsetY)}}),h(j.a,'mouseup',function(f){for(var u=0,R=j.g,pa=R.length;u<pa;u=u+1|0){var g=R[u];g.n(f.offsetX,f.offsetY)}}),h(j.a,'mouseleave',function(k){for(var v=0,S=j.g,qa=S.length;v<qa;v=v+1|0){var i=S[v];i.n(k.offsetX,k.offsetY)}}),h(j.a,'wheel',function(O){for(var w=0,T=j.g,ra=T.length;w<ra;w=w+1|0){var aa=T[w];aa.C(O.offsetX,O.offsetY,O.deltaY)}}),h(j.a,'touchstart',function(wa){for(var x=0,U=j.k,sa=U.length;x<sa;x=x+1|0){var ba=U[x];ba.X(wa)}}),h(j.a,'touchmove',function(xa){for(var y=0,V=j.k,ta=V.length;y<ta;y=y+1|0){var ca=V[y];ca.Y(xa)}}),h(j.a,'touchend',function(ya){for(var z=0,W=j.k,ua=W.length;z<ua;z=z+1|0){var da=W[z];da.Z(ya)}})}function ea(a){a.b=a.c=null}function r(c,a,b){if(!c.c)throw new Error("Shouldn't call _gridSpaceFromCanvasSpace unless _onDownViewport is set");return F(new Ja(a,b),new Ja(c.a.a.width,c.a.a.height),c.c.a)}function G(c,a){if(!c.b)throw new Error("Shouldn't call _delta unless _onDownGridSpace is set");
var b=J(c.b.a,a);return b.b*=-1,b}function fa(a){return new Fa(a.a.a,a.a.b,a.b.a,a.b.b)}function ga(b,a){return l(b.a,K(a,b.b))}function ha(f,a){for(var b=new Uint8Array(f.b*f.b<<2),c=0,g=a.length;c<g;c=c+1|0){var e=c<<2;b[e]=a[c]^1?0:255,b[e+1|0]=a[c]^1?0:255,b[e+2|0]=a[c]^1?0:255,b[e+3|0]=255}f.f.subset(b,0,0,f.b,f.b)}function ia(b){b.k.attach(b.g),b.f.bind(0),b.a.gl.viewport(0,0,b.b,b.b),b.c.use().attrib('quad',b.e,2).uniformi('cellGridTexture',0).uniform('cellGridSize',new Float32Array([b.b,b.b])).draw(5,4);var a=b.f;b.f=b.g,b.g=a}function H(g,a){var b=d(a.touches)[0],c=d(a.touches)[1],e=new Ja(b.clientX,b.clientY),f=new Ja(c.clientX,c.clientY);return Math.sqrt(ma(e,f))}function ja(g,a){var b=d(a.touches)[0],c=d(a.touches)[1],e=new Ja(b.clientX,b.clientY),f=new Ja(c.clientX,c.clientY);return ka(l(e,f),2)}function I(f,a){var b=ja(f,a),c=H(f,a),e=f.c-c;f.e.C(b.a|0,b.b|0,e),f.c=c}function l(b,a){return new Ja(b.a+a.a,b.b+a.b)}function J(b,a){return new Ja(b.a-a.a,b.b-a.b)}function K(b,a){return new Ja(b.a*a.a,
b.b*a.b)}function L(b,a){return new Ja(b.a/a.a,b.b/a.b)}function ka(b,a){return new Ja(b.a/a,b.b/a)}function la(a){return Math.sqrt(a.a*a.a+a.b*a.b)}function ma(b,a){return b.a*a.a+b.b*a.b}function M(a){return new Float32Array([a.a,a.b])}function N(c,a,b){b?c.b=c.a*a.b/a.a:c.a=c.b*a.a/a.b}function m(){return new Ja(0,0)}function d(a){for(var b=[],c=0,e=a.length;c<e;c=c+1|0)b.push(a[c]);return b}function h(a,b,c){a.addEventListener(b,c)}function p(a){a.preventDefault()}function za(a){this.a=a}function Ba(a){var b=this;if(b.b=b.c=null,b.e=b.f=null,b.g=b.k=null,b.i=null,b.a=a,b.i=new Fa(0,0,700,700),b.c=new Igloo(a),!b.c.gl){document.getElementById('app-container').style.display='none',document.getElementById('webgl-error').style.display=null;throw new Error('Failed to initialize Igloo')}b.b=new Ga(b.c,va),b.c.gl.disable(2929),b.e=b.c.program('glsl/quad.vert','glsl/draw_grid.frag'),b.f=b.c.array(Igloo.QUAD2),b.g=[new Da(b),new Ea(b)],b.k=[new Ha(b),new Ia(b)],$(b),D(b),h(window,'resize',function(){D(b)})}function Da(a){
this.a=a,this.b=this.c=null}o=Da.prototype;o.A=function(a,b){this.c=new za(fa(this.a.i)),this.b=new za(r(this,a,b))};o.B=function(a,b){if(this.b){var c=r(this,a,b),e=G(this,c);this.a.i.a=l(this.c.a.a,e)}};o.n=function(a,b){if(this.b){var c=r(this,a,b),e=G(this,c);la(e)>10&&(this.a.i.a=l(this.c.a.a,e))}ea(this)};o.C=function(a,b,c){};function Ea(a){this.a=a}o=Ea.prototype;o.A=function(a,b){};o.B=function(a,b){};o.n=function(a,b){};o.C=function(a,b,c){b=(q(this.a).b|0)-b|0;var e=F(new Ja(a,b),q(this.a),this.a.i),f=new Ja(c,c),g=l(this.a.i.b,f),k=J(e,K(L(new Ja(a,b),q(this.a)),g));if(g.a>15&&g.b>15&&g.a<2500&&g.b<2500){this.a.i.a=k,this.a.i.b=g;var i=new Ja(this.a.a.width,this.a.a.height);N(this.a.i.b,i,1)}};function Fa(a,b,c,e){this.a=m(),this.b=m(),this.a=new Ja(a,b),this.b=new Ja(c,e)}function Ga(a,b){this.c=this.e=null,this.f=this.g=null,this.k=null,this.a=a,this.b=b;var c=this.a.gl;c.disable(2929),this.c=this.a.program('glsl/quad.vert','glsl/game_of_life.frag'),this.e=a.array(Igloo.QUAD2),this.f=this.a.texture(null,
6408,10497,9728).blank(this.b,this.b),this.g=this.a.texture(null,6408,10497,9728).blank(this.b,this.b),this.k=this.a.framebuffer();for(var e=new Uint8Array(Aa(this.b,this.b)),f=0,g=e.length;f<g;f=f+1|0)e[f]=Math.random()<.5?1:0;ha(this,e)}function Ha(a){this.a=a,this.b=!1,this.c=null}o=Ha.prototype;o.X=function(a){d(a.touches).length^1||(this.b=!0,this.c=new Da(this.a),this.c.A(d(a.touches)[0].clientX,d(a.touches)[0].clientY)),p(a)};o.Y=function(a){this.b&&d(a.touches).length==1&&this.c.B(d(a.touches)[0].clientX,d(a.touches)[0].clientY),p(a)};o.Z=function(a){this.b&&d(a.touches).length==1&&this.c.n(d(a.touches)[0].clientX,d(a.touches)[0].clientY),p(a)};function Ia(a){this.a=a,this.b=!1,this.c=-1,this.e=null}o=Ia.prototype;o.X=function(a){d(a.touches).length^2||(this.b=!0,this.c=H(this,a),this.e=new Ea(this.a))};o.Y=function(a){this.b&&d(a.touches).length==2&&I(this,a)};o.Z=function(a){this.b&&d(a.touches).length==2&&(I(this,a),this.b=!1)};function Ja(a,b){this.a=a,this.b=b}var va=1024;Ca()})();
